<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Heart's Code üîê</title>
    <style>
        /* UNIVERSAL RESET */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f0b24 0%, #1e1b3a 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .game-wrapper {
            width: 100%;
            max-width: 600px;
            background: rgba(25, 23, 45, 0.95);
            border-radius: 24px;
            padding: 40px;
            border: 2px solid rgba(113, 76, 255, 0.3);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        /* MYSTERY HEADER */
        .mystery-header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }
        
        .puzzle-icon {
            font-size: 4rem;
            color: #714cff;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px rgba(113, 76, 255, 0.5));
            animation: float 4s ease-in-out infinite;
        }
        
        .game-title {
            font-size: 2.8rem;
            background: linear-gradient(45deg, #714cff, #ff4c8d);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            font-weight: 800;
            letter-spacing: 1px;
        }
        
        .mystery-text {
            color: #a0a0c0;
            font-size: 1.1rem;
            opacity: 0.8;
        }
        
        /* GAME AREA */
        .game-area {
            background: rgba(40, 38, 65, 0.8);
            border-radius: 18px;
            padding: 30px;
            margin: 30px 0;
            border: 1px solid rgba(113, 76, 255, 0.2);
        }
        
        /* CODE DISPLAY - MYSTERY BOXES */
        .code-display {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }
        
        .code-box {
            width: 80px;
            height: 80px;
            background: rgba(0, 0, 0, 0.3);
            border: 3px solid rgba(113, 76, 255, 0.5);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            color: white;
            position: relative;
            transition: all 0.3s;
        }
        
        .code-box.filled {
            border-color: #ff4c8d;
            background: rgba(255, 76, 141, 0.1);
            box-shadow: 0 0 20px rgba(255, 76, 141, 0.3);
        }
        
        .code-box.empty::after {
            content: '?';
            color: rgba(255, 255, 255, 0.3);
            font-size: 2rem;
        }
        
        /* INPUT METHOD - KEYPAD */
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            max-width: 320px;
            margin: 30px auto;
        }
        
        .key {
            background: rgba(113, 76, 255, 0.1);
            border: 2px solid rgba(113, 76, 255, 0.3);
            border-radius: 12px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
        }
        
        .key:hover {
            background: rgba(113, 76, 255, 0.2);
            border-color: #714cff;
            transform: translateY(-2px);
        }
        
        .key:active {
            transform: translateY(0);
        }
        
        .key.clear {
            background: rgba(255, 76, 141, 0.1);
            border-color: rgba(255, 76, 141, 0.3);
            grid-column: span 2;
            font-size: 1.3rem;
        }
        
        .key.enter {
            background: rgba(76, 217, 100, 0.1);
            border-color: rgba(76, 217, 100, 0.3);
            font-size: 1.3rem;
        }
        
        /* HINTS - HIDDEN INITIALLY */
        .hint-section {
            margin-top: 40px;
            opacity: 0;
            transition: opacity 0.5s;
            max-height: 0;
            overflow: hidden;
        }
        
        .hint-section.visible {
            opacity: 1;
            max-height: 500px;
        }
        
        .hint-box {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid rgba(255, 193, 7, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            display: none;
        }
        
        .hint-box.show {
            display: block;
            animation: slideUp 0.5s ease;
        }
        
        .hint-header {
            color: #ffc107;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        /* ATTEMPTS */
        .attempts-tracker {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 25px 0;
        }
        
        .attempt {
            width: 30px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            transition: all 0.3s;
        }
        
        .attempt.used {
            background: #ff4c8d;
            box-shadow: 0 0 10px #ff4c8d;
        }
        
        /* FEEDBACK MESSAGES */
        .feedback {
            text-align: center;
            min-height: 60px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .feedback-message {
            padding: 15px 25px;
            border-radius: 50px;
            font-weight: 600;
            display: none;
            animation: popIn 0.3s;
        }
        
        .feedback-correct {
            background: rgba(76, 217, 100, 0.2);
            color: #4cd964;
            border: 2px solid #4cd964;
        }
        
        .feedback-incorrect {
            background: rgba(255, 59, 48, 0.2);
            color: #ff3b30;
            border: 2px solid #ff3b30;
        }
        
        /* LOGICAL CLUE SYSTEM */
        .logic-puzzle {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #714cff;
        }
        
        .logic-statement {
            margin: 10px 0;
            padding-left: 10px;
            border-left: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        /* ANIMATIONS */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .shake { animation: shake 0.5s; }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px #714cff; }
            50% { box-shadow: 0 0 20px #714cff; }
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .game-wrapper { padding: 25px; }
            .game-title { font-size: 2.2rem; }
            .code-box { width: 60px; height: 60px; font-size: 2rem; }
            .keypad { gap: 10px; }
            .key { height: 60px; font-size: 1.5rem; }
        }
        
        @media (max-width: 480px) {
            .game-wrapper { padding: 20px; margin: 10px; }
            .code-box { width: 50px; height: 50px; font-size: 1.8rem; }
            .keypad { grid-template-columns: repeat(3, 1fr); }
            .key { height: 55px; }
        }
        
        /* PRINT FRIENDLY */
        @media print {
            .game-wrapper { border: 2px solid #000; box-shadow: none; }
            .keypad, .key { display: none; }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="game-wrapper">
        <!-- MYSTERY HEADER -->
        <div class="mystery-header">
            <div class="puzzle-icon">
                <i class="fas fa-brain"></i>
            </div>
            <h1 class="game-title">Heart's Riddle</h1>
            <p class="mystery-text">Crack the code to discover what's hidden in my heart</p>
        </div>
        
        <!-- GAME AREA -->
        <div class="game-area">
            <!-- ATTEMPTS TRACKER -->
            <div class="attempts-tracker" id="attempts">
                <div class="attempt" id="attempt1"></div>
                <div class="attempt" id="attempt2"></div>
                <div class="attempt" id="attempt3"></div>
                <div class="attempt" id="attempt4"></div>
                <div class="attempt" id="attempt5"></div>
            </div>
            
            <!-- CODE DISPLAY -->
            <div class="code-display">
                <div class="code-box empty" id="box1"></div>
                <div class="code-box empty" id="box2"></div>
                <div class="code-box empty" id="box3"></div>
            </div>
            
            <!-- INITIAL FEEDBACK -->
            <div class="feedback">
                <div class="feedback-message" id="initialFeedback">
                    <i class="fas fa-question-circle"></i>
                    The code is 3 digits. Start guessing...
                </div>
            </div>
            
            <!-- LOGICAL PUZZLE (HIDDEN INITIALLY) -->
            <div class="logic-puzzle" id="logicPuzzle" style="display: none;">
                <h3><i class="fas fa-puzzle-piece"></i> Logical Statements</h3>
                <div class="logic-statement" id="logic1"></div>
                <div class="logic-statement" id="logic2"></div>
                <div class="logic-statement" id="logic3"></div>
            </div>
            
            <!-- KEYPAD -->
            <div class="keypad">
                <div class="key" data-key="1">1</div>
                <div class="key" data-key="2">2</div>
                <div class="key" data-key="3">3</div>
                <div class="key" data-key="4">4</div>
                <div class="key" data-key="5">5</div>
                <div class="key" data-key="6">6</div>
                <div class="key" data-key="7">7</div>
                <div class="key" data-key="8">8</div>
                <div class="key" data-key="9">9</div>
                <div class="key clear" onclick="clearCode()">
                    <i class="fas fa-eraser"></i> Clear
                </div>
                <div class="key" data-key="0">0</div>
                <div class="key enter" onclick="submitCode()">
                    <i class="fas fa-paper-plane"></i> Submit
                </div>
            </div>
        </div>
        
        <!-- HINTS SECTION (HIDDEN INITIALLY) -->
        <div class="hint-section" id="hintSection">
            <div class="hint-box" id="hint1">
                <div class="hint-header">
                    <i class="fas fa-lightbulb"></i>
                    <strong>Hint 1:</strong> Think about significant dates
                </div>
                <p>It's not a random number. When did something important happen?</p>
            </div>
            
            <div class="hint-box" id="hint2">
                <div class="hint-header">
                    <i class="fas fa-calendar-day"></i>
                    <strong>Hint 2:</strong> Month and day combination
                </div>
                <p>The first digit represents a month. Which month means something to us?</p>
            </div>
            
            <div class="hint-box" id="hint3">
                <div class="hint-header">
                    <i class="fas fa-heart"></i>
                    <strong>Hint 3:</strong> March 29th
                </div>
                <p>March is the 3rd month, 29 is the day. Combine them: 3 + 29 = ?</p>
            </div>
            
            <div class="hint-box" id="hint4">
                <div class="hint-header">
                    <i class="fas fa-key"></i>
                    <strong>Final Hint:</strong> The code is 329
                </div>
                <p>March 29 = 3 (month) 29 (day). The code is <strong>329</strong></p>
            </div>
        </div>
        
        <!-- FEEDBACK MESSAGES -->
        <div class="feedback">
            <div class="feedback-message feedback-incorrect" id="wrongFeedback"></div>
            <div class="feedback-message feedback-correct" id="correctFeedback"></div>
        </div>
    </div>

    <script>
        // GAME CONFIGURATION
        const CORRECT_CODE = "329";
        let currentAttempt = "";
        let totalAttempts = 0;
        let wrongAttempts = 0;
        const maxAttempts = 5;
        let hintsRevealed = 0;
        
        // DOM Elements
        const codeBoxes = [
            document.getElementById('box1'),
            document.getElementById('box2'),
            document.getElementById('box3')
        ];
        
        const attemptElements = [
            document.getElementById('attempt1'),
            document.getElementById('attempt2'),
            document.getElementById('attempt3'),
            document.getElementById('attempt4'),
            document.getElementById('attempt5')
        ];
        
        const hintSection = document.getElementById('hintSection');
        const logicPuzzle = document.getElementById('logicPuzzle');
        const initialFeedback = document.getElementById('initialFeedback');
        const wrongFeedback = document.getElementById('wrongFeedback');
        const correctFeedback = document.getElementById('correctFeedback');
        
        // Initialize game
        function initGame() {
            // Show initial feedback briefly
            initialFeedback.style.display = 'block';
            setTimeout(() => {
                initialFeedback.style.display = 'none';
            }, 3000);
            
            // Setup keypad listeners
            document.querySelectorAll('.key[data-key]').forEach(key => {
                key.addEventListener('click', () => {
                    if (currentAttempt.length < 3) {
                        currentAttempt += key.dataset.key;
                        updateDisplay();
                        playSound('click');
                    }
                });
            });
            
            // Keyboard support
            document.addEventListener('keydown', handleKeyPress);
            
            // Update attempt display
            updateAttemptDisplay();
        }
        
        // Handle keyboard input
        function handleKeyPress(e) {
            if (e.key >= '0' && e.key <= '9' && currentAttempt.length < 3) {
                currentAttempt += e.key;
                updateDisplay();
            } else if (e.key === 'Enter') {
                submitCode();
            } else if (e.key === 'Backspace' || e.key === 'Delete') {
                clearCode();
            }
        }
        
        // Update code display
        function updateDisplay() {
            codeBoxes.forEach((box, index) => {
                if (index < currentAttempt.length) {
                    box.textContent = currentAttempt[index];
                    box.classList.add('filled');
                    box.classList.remove('empty');
                } else {
                    box.textContent = '';
                    box.classList.remove('filled');
                    box.classList.add('empty');
                }
            });
        }
        
        // Clear code
        function clearCode() {
            currentAttempt = "";
            updateDisplay();
            playSound('clear');
        }
        
        // Submit code
        function submitCode() {
            if (currentAttempt.length !== 3) {
                showFeedback("Please enter 3 digits", wrongFeedback);
                shakeCodeBoxes();
                return;
            }
            
            totalAttempts++;
            
            if (currentAttempt === CORRECT_CODE) {
                // WIN!
                showFeedback("üéâ Brilliant! You cracked the code!", correctFeedback);
                codeBoxes.forEach(box => {
                    box.style.animation = 'glow 0.5s 3';
                    box.style.borderColor = '#4cd964';
                });
                
                // Disable input
                document.querySelectorAll('.key').forEach(key => {
                    key.style.opacity = '0.5';
                    key.style.pointerEvents = 'none';
                });
                
                // Redirect to gift
                setTimeout(() => {
                    window.location.href = 'gift.html';
                }, 2000);
                
            } else {
                // WRONG - Increment wrong attempts
                wrongAttempts++;
                updateAttemptDisplay();
                
                // Show logical puzzle after 2 wrong attempts
                if (wrongAttempts >= 2) {
                    logicPuzzle.style.display = 'block';
                    updateLogicPuzzle();
                }
                
                // Show hint section after 1 wrong attempt
                if (wrongAttempts >= 1) {
                    hintSection.classList.add('visible');
                    revealNextHint();
                }
                
                // Show specific feedback based on attempt
                const feedbackMessages = [
                    "Hmm, not quite... Try thinking about dates",
                    "Interesting guess, but not right. Look at the hints below",
                    "You're getting closer! Check the logical statements",
                    "Almost there! The hints should help now",
                    "The code is 329 (March 29). Let me show you your gift!"
                ];
                
                showFeedback(feedbackMessages[wrongAttempts - 1], wrongFeedback);
                
                // If max attempts reached, show answer and redirect
                if (wrongAttempts >= maxAttempts) {
                    setTimeout(() => {
                        showFeedback("The code was 329. Taking you to your gift...", wrongFeedback);
                        setTimeout(() => {
                            window.location.href = 'gift.html';
                        }, 2000);
                    }, 1000);
                }
                
                // Clear for next attempt
                setTimeout(() => {
                    currentAttempt = "";
                    updateDisplay();
                }, 1000);
            }
        }
        
        // Update attempt display
        function updateAttemptDisplay() {
            attemptElements.forEach((attempt, index) => {
                if (index < wrongAttempts) {
                    attempt.classList.add('used');
                } else {
                    attempt.classList.remove('used');
                }
            });
        }
        
        // Update logic puzzle
        function updateLogicPuzzle() {
            const logic1 = document.getElementById('logic1');
            const logic2 = document.getElementById('logic2');
            const logic3 = document.getElementById('logic3');
            
            if (wrongAttempts >= 2) {
                logic1.innerHTML = "üî¢ <strong>Statement 1:</strong> The code consists of digits from a specific date";
                logic1.style.display = 'block';
            }
            
            if (wrongAttempts >= 3) {
                logic2.innerHTML = "üìÖ <strong>Statement 2:</strong> First digit = Month number (1-12)";
                logic2.style.display = 'block';
            }
            
            if (wrongAttempts >= 4) {
                logic3.innerHTML = "üíñ <strong>Statement 3:</strong> Last two digits = Day number (1-31)";
                logic3.style.display = 'block';
            }
        }
        
        // Reveal hints gradually
        function revealNextHint() {
            hintsRevealed++;
            const hintId = `hint${hintsRevealed}`;
            const hintElement = document.getElementById(hintId);
            
            if (hintElement) {
                setTimeout(() => {
                    hintElement.classList.add('show');
                    playSound('hint');
                }, hintsRevealed * 500);
            }
        }
        
        // Show feedback message
        function showFeedback(message, element) {
            wrongFeedback.style.display = 'none';
            correctFeedback.style.display = 'none';
            
            element.textContent = message;
            element.style.display = 'block';
            
            // Auto-hide after 3 seconds
            if (element === wrongFeedback && wrongAttempts < maxAttempts) {
                setTimeout(() => {
                    element.style.display = 'none';
                }, 3000);
            }
        }
        
        // Shake animation for wrong attempts
        function shakeCodeBoxes() {
            codeBoxes.forEach(box => {
                box.classList.add('shake');
                setTimeout(() => {
                    box.classList.remove('shake');
                }, 500);
            });
        }
        
        // Simple sound effects
        function playSound(type) {
            // Can add actual sounds if needed
            console.log(`Play ${type} sound`);
        }
        
        // Browser compatibility check
        function checkCompatibility() {
            // Simple feature detection
            if (!('querySelector' in document)) {
                // Fallback for very old browsers
                document.body.innerHTML = `
                    <div style="text-align:center; padding:50px; color:white;">
                        <h2>Game requires modern browser</h2>
                        <p>Code: 329</p>
                        <p><a href="gift.html" style="color:#714cff;">Click here for your gift</a></p>
                    </div>
                `;
            }
        }
        
        // Initialize when ready
        document.addEventListener('DOMContentLoaded', function() {
            checkCompatibility();
            initGame();
        });
        
        // Fallback for very old browsers
        window.onload = function() {
            // Ensure everything works
            if (!document.querySelector('.keypad')) {
                // Create simple fallback
                const fallback = `
                    <div style="text-align:center; padding:20px;">
                        <h3>Enter Code: 329</h3>
                        <input type="text" id="simpleCode" maxlength="3">
                        <button onclick="if(document.getElementById('simpleCode').value=='329'){window.location='gift.html'}">Submit</button>
                    </div>
                `;
                document.body.innerHTML += fallback;
            }
        };
    </script>
    
    <!-- No JavaScript fallback -->
    <noscript>
        <style>
            .game-wrapper { display: none; }
        </style>
        <div style="text-align:center; padding:50px; color:white;">
            <h2>JavaScript is required for this game</h2>
            <p>The code is: <strong>329</strong> (March 29)</p>
            <p><a href="gift.html" style="color:#714cff; text-decoration:none; font-size:1.2rem;">
                <i class="fas fa-gift"></i> Go to your gift
            </a></p>
        </div>
    </noscript>
</body>
</html>